<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" /> 
    <title>Twittler</title>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <header>
      <p>Twittler v.0.0.1</p>
    </header>

    <div id="stream">
    </div>

    <script>
      $(document).ready(function(){

        // Initially load the Twitter stream
        var index = streams.home.length - 1;

        // Keep track of where our old initial index was so that we can display
        // new tweets that are pushed to the array and stop when we get to 
        // tweets that have already been displayed.
        var oldindex = index;

        // Get tweets from our array.
        var getTweets = function (action) {
          var tweet = streams.home[index];
          var $tweet = $('<div class="tweet" data-username="' + tweet.user +'"></div>');
          //$tweet.text('@' + tweet.user + ': ' + tweet.message);
          $tweet.html('<a href="#">@' + tweet.user + '</a>: ' + tweet.message + '<br>' + tweet.created_at + '<br><br>');
          $tweet.prependTo($("#stream"));        
        }


        while(index >= 0){
          getTweets();
          index -= 1;
        }

        // Call this function with an interval to get new tweets that have been pushed to the stream.
        var updateStream = function() {
          index = streams.home.length - 1;
          var newIndex = index + 1;
          while (index >= oldindex) {
            getTweets();
            index -= 1;
          };
          oldindex = newIndex;
        };

        // Update the stream at a set interval and append new tweets to the page.
        setInterval(function() {
          updateStream();

        }, 1500);
      
        // Filter the stream to only show tweets from a specific username.
        $('#stream').on('click', 'a', function() {
          // Store the username that we want to filter.
          var filtername = $(this).closest('.tweet').data('username');

          // Clear out stream so we can only display tweets from specific user.
          $('#stream').html('');

          // Display all tweets from user.
          // TODO: Refactor our initial getTweet function to utilize this code as well.
          var userTweets = streams.users[filtername];
          var countTweets = userTweets.length - 1;

          console.log(userTweets);
          console.log(countTweets);

          //while(countTweets >= 0){
          for (var i = 0; i <= countTweets; i++) {
            var tweet = userTweets[i];
            var $tweet = $('<div class="tweet" data-username="' + tweet.user +'"></div>');
            //$tweet.text('@' + tweet.user + ': ' + tweet.message);
            $tweet.html('<a href="#">@' + tweet.user + '</a>: ' + tweet.message + '<br>' + tweet.created_at + '<br><br>');
            $tweet.prependTo($("#stream"));   

            //countTweets -= 1;
          }          
          


          //alert(numUserTweets.length);

          //alert("GOT YOU GOOD. " + filtername);
        });      

      });
    </script>
  </body>
</html>
